
$(document).ready(function(){


 
  $('#top_row').css({"height": ($( window ).height() * (3/10))});
  $('#slides').css({"height": $( window ).height() * (0.369)});

  // set height to viewfinder height
  $(window).resize(function(){
    $("#main_container").height($(window).height());
  });

  $(function(){
      $("#slides").slidesjs({
        play: {
          active: true,
          effect: "slide",
          interval: 5000,
          auto: true,
          swap: true,
          pauseOnHover: true,
          restartDelay: 2500
    },
        width: $('#slides').width(),
        height: $('#slides').height() * 0.8,
        navigation: true
      });
    });


  // $('.stats_item').hide();

  // function fadeInSequence(stats_item){
  //     var next = $('stats_item').next() !=null ? function(){fadeInSequence(stats_item).next());} : function(){fadeInSequence($('.stats_item:first'));};
  //     $(stats_item).fadeIn(500).delay(2000).hide(300,next);
  // }

  // fadeInSequence($('.stats_item:first'));


  
  // current production -----------------------------------------------

   new Highcharts.Chart({
    chart: {
      borderRadius: 0,
      height: $('#slides').height() * 0.8,
      width: $('#power_all_time').width() * (1/2),
      renderTo: "current_production",
      type: 'areaspline',
      backgroundColor: '#C3C9C9',
      plotBackgroundColor: null,
      animation: Highcharts.svg,
      style: {
        fontSize: '2em',
      },
      events: {
        load: function() {
          setInterval(function() {
            <%= SolarData.get_current_production %>
            var chart = $('#current_production').highcharts();
            chart.series[0].setData(<%= DailyProduction.last["production_totals"] %>)
              // is the above actually inserting the new data into the setData function?
          }, 300000);
        }
      }
    },
    title: {
      text: "Energy Produced today, by the Hour",
      style: {
      color: '#cc0000',
      fontWeight: 'bold',
      fontSize: '25px',
      fontFamily: '\'orbitron-light\', sans-serif'
      }
    },
    legend: {
      enabled: false
    },        
    xAxis: {
      type: "datetime",
      tickColor: '#dac092',
      labels: {
        style: {
          color: '#89A54E'
        }
      }
    },
    yAxis: {
      title: {
        text: "Watt-Hours", 
        style: {
          color: '#89A54E'
        }
      }
    },
    plotOptions: {
      series: {
        fillColor: {
          linearGradient: [0,0,0,300],
          stops: [
            [0, '#00FF64'],
            [1, 'rgba(0, 20, 10, 0.7)']
          ]
        },
        shadow: true,
        offsetX: "3px",
        offsetY:"3px",
        opacity:"0.6",
        lineColor: '#00FF64',
        marker: {
          enabled: false,
        }
      }
    },
    series: [
      {   
        name: "Yesterday's Production",
        pointInterval: <%= 300 * 1000 %>,
        pointStart: <%= (DailyProduction.last.for_day.beginning_of_day.to_i)*1000 %>,
        data: <%= DailyProduction.last.production_totals %>
      } 
    ]       
  });




             // All-time production -----------------------------------------------
  
  new Highcharts.Chart({
    chart: {
      borderRadius: 0,
      width: ( $('#power_all_time').width() ),
      height: ($( window ).height() * (1/5)),
      renderTo: "power_all_time",
      backgroundColor: "#C3C9C9",
      plotBackgroundColor: null,
      type: 'areaspline',
      style: {
        color: "#990000",
        fontSize: '2em',
        title: {
          style: {
            color: '#cc0000',
            fontWeight: 'bold'
          }
        },
      },
    },
    legend: {
      enabled: false
    },
    xAxis: {
      type: "datetime",
      tickColor: '#dac092',
      labels: {
        style: {
          color: '#89A54E'
        }
      }
    },
    title: {
      text: "Energy Production Per Day",
      style: {
        color: '#cc0000',
        fontWeight: 'bold',
        fontSize: '25px',
        fontFamily: '\'orbitron-light\', sans-serif'
      }
    },
    yAxis: {
      title: {
        text: "Watt-Hours",
        lineColor: '#dac092',
        style: {
          color: "#cc0000"
        }
      },
      labels: {
        style: {
          color: '#89A54E'
        }
      }
    },

    plotOptions: {
      series: {
        fillColor: {
          linearGradient: [0,0,0,300],
          stops: [
            [0, '#00FF64'],
            [1, 'rgba(0, 20, 10, 0.7)']
          ]
        },
        shadow: true,
        offsetX: "3px",
        offsetY:"3px",
        opacity:"0.6",
        lineColor: '#00FF64',
        marker: {
          enabled: false,
        }
      }
    },

    series: [
      {   
        name: "All-time Production",
        pointInterval: <%= 86400000 %>,
        pointStart: <%= (Date.new(2013,9,11).beginning_of_day.to_i) * 1000 %>,
        data: <%= EnergyLifetimeArray.last.raw_array %>
      } 
    ]       
  });

  // Week-by-week production -----------------------------------------------
  new Highcharts.Chart({
    chart: {
      borderRadius: 0,
      height: $('#slides').height() * (0.8),
      width: $('#slides').width(),
      renderTo: "weekly_data",
      type: 'areaspline',
      backgroundColor: '#C3C9C9',
      plotBackgroundColor: null
    },

    title: {
      text: "Daily Totals",
      style: {
        color: '#cc0000',
        fontWeight: 'bold',
        fontSize: '25px',
        fontFamily: '\'orbitron-light\', sans-serif'
      }
    },            
    
    legend: {
      enabled: true,
      align: 'center',
      style: {
        fontSize: '15px'  
      }
    },
    
    xAxis: {
      categories: [
        'Sunday',
        'Monday',
        'Tuesday',
        'Wednesday',
        'Thursday',
        'Friday',
        'Saturday'
      ],
      labels: {
        style: {
          color: '#89A54E'
        }
      }
    },

    yAxis: {
      title: {
        text: "Watt-Hours",
        style: {
          color: '#89A54E'
        }
      }
    },

    plotOptions: {
      series: {
        // fillColor: {
        //   linearGradient: [0,0,0,300],
        //   stops: [
        //     [0, '#00FF64'],
        //     [1, 'rgba(0, 20, 10, 0.7)']
        //   ]
        // },
        shadow: true,
        offsetX: "3px",
        offsetY:"3px",
        opacity:"0.3",
        // lineColor: '#00FF64',
        marker: {
          enabled: false,
        }
      }
    },

    series: [
      <% WeeklyData.limit(3).order('id desc').each_with_index do |week, index| %>
        {   
          name: "Week of <%= week.forWeek.strftime("%m-%d")%>",
          data: <%= week.weeklyProduction  %>
        }<% if index <= 2 %>,<% end %>
      <% end %>
    ]       
  });

});  

//   new Highcharts.Chart({
//             chart: {
//               height: ($( window ).height() * (2/5)),
//               width: ($('#power_all_time').width() * (1/2)),
//               renderTo: "monthly_data",
//               type: 'area',
//               backgroundColor: '#000000',
//               plotBackgroundColor: null
//             },
//             title: {
//               text: "Month by Month",
//             style: {
//                 color: '#cc0000',
//                 fontWeight: 'bold',
//                 fontSize: '25px',
//                 fontFamily: '\'orbitron-light\', sans-serif'

//             }
//         },
//             legend: {
//               enabled: false
//             },
//         xAxis: {
//               type: "datetime",
//               tickColor: '#dac092',
//               labels: {
//                 style: {
//                   color: '#89A54E'
//                 }
//               }
//             },
//             yAxis: {
//               title: {
//                 text: "Watt-Hours",
//                 style: {
//                   color: '#89A54E'
//                 }
//               }
//             },
//  plotOptions: {
//             series: {
//               fillColor: {
//                 linearGradient: [0,0,0,300],
//                 stops: [
//                   [0, '#00FF64'],
//                   [1, 'rgba(0, 20, 10, 0.7)']
//                 ]
//               },

//                    shadow: true,
//                    offsetX: "3px",
//                    offsetY:"3px",
//                    opacity:"0.6",
//               lineColor: '#00FF64',
//                 marker: {
//                     enabled: false,
//                 }
//             }
//         },
//             series: [
//                     {    
//                         name: "All-time Production",
//                         data: <%= SolarData.retrieve_monthly_data %>
//                     } 

//             ]       
// });



